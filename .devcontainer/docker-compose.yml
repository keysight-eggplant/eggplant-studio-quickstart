services:
  workspace:
    build:
      dockerfile: Dockerfile
      context: .
    volumes:
      - ..:/workspace
      - vscode:/home/vscode
      - /var/run/docker.sock:/var/run/docker.sock
    command: sleep infinity

  # Hosts the Eggplant Fusion Engine in Debug Adapter mode in a service container
  # called fusionengine
  fusionengine:
    image: "quay.io/eggplantsoftware/fusion-engine-ubi8:23.5.102"
    volumes:
      - ..:/workspace
      - vscode:/home/vscode
    command: -drivePort 5400 -dapport 4711 -DisableEACPolling YES
    environment:
      EGGPLANT_ACCEPT_EULA: ${EGGPLANT_ACCEPT_EULA}
      EGGPLANT_ACCEPT_PRIVACY_AGREEMENT: ${EGGPLANT_ACCEPT_PRIVACY_AGREEMENT}
      EGGPLANT_LICENSE_KEY: ${EGGPLANT_LICENSE_KEY}
    network_mode: "service:workspace"

volumes:
  vscode:
